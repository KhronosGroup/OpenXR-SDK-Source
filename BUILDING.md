# How to Build

## Python

Certain source files are generated at build time from the `xr.xml` file, utilizing 
python scripts. The scripts make use of the python `pathlib` module, which is 
fully supported as of python version 3.6. A known good version of python is 3.7.2,
and a known failing version is 3.5.2 (on Windows).

## Windows

Building the OpenXR components in this tree on Windows is supported using
Visual Studio 2013 and newer.  Before beginning, make sure the appropriate
"msbuild.exe" is in your PATH.  Also, when generating the solutions/projects
using CMake, be sure to use the correct compiler version number.  The
following table is provided to help you:

| Visual Studio        | Version Number |
| -------------------- |:--------------:|
| Visual Studio 2013   |       12       |
| Visual Studio 2015   |       14       |
| Visual Studio 2017   |       15       |

**NOTE:** CMake can not create Visual Studio solutions or projects that can
generate both 64-bit and 32-bit binaries.  Instead, if you need both, you must
perform the following steps individually.  Otherwise, simply build for the
target you desire.

### Windows 64-bit

First, generate the 64-bit solution and project files using CMake:

```
mkdir build\win64
cd build\win64
cmake -G "Visual Studio [Version Number] Win64" ..\..
```

Finally, open the build\win64\OPENXR.sln in the Visual Studio to build the samples.

### Windows 32-bit

First, generate the 32-bit solution and project files using CMake:

```
mkdir build\win32
cd build\win32
cmake -G "Visual Studio [Version Number]" ..\..
```

Open the build\win32\OPENXR.sln in the Visual Studio to build the samples.

## Linux Debug

```
mkdir -p build/linux_debug
cd build/linux_debug
cmake -DCMAKE_BUILD_TYPE=Debug ../..
make
```

## Linux Release

```
mkdir -p build/linux_release
cd build/linux_release
cmake -DCMAKE_BUILD_TYPE=Release ../..
make
```

## (Optional) Building the OpenXR Loader as a DLL  

The OpenXR loader is built as a static library by default. To instead build as a dynamic link library, define
the cmake option `DYNAMIC_LOADER=ON`.  e.g. for Win64, replace the cmake line shown above with:

```
cmake -DDYNAMIC_LOADER=ON -G "Visual Studio [Version Number] Win64" ..\..
```

### Configuring the OpenXR Loader - Linux

Since this CMake project tree doesn't represent a typical deployment on Linux, it is necessary to set
up the environment to reflect the location of the binaries, etc, in the user's build tree.

LD\_LIBRARY\_PATH

The JSON file describing the implementation specifies the `library_path` as a simple path-less filename, since
it is not known where in the filesystem the user's build tree is placed.
Therefore, the Linux loader needs to be told where to find the implementation's shared library.
This is accomplished by setting the LD\_LIBRARY\_PATH environment variable to include `<build_dir>/src/impl`.

Alternately, the user may edit the `openxr_sample_impl.json` file and set `library_path` to the full
pathname of the implementation binary.
But some custom value for `library_path` would typically only be useful for a particular user's "sandbox".

XR\_RUNTIME\_JSONS

The OpenXR loader looks in system-specific locations for the JSON files that describe implementations.
Rather than placing these files in filesystem locations that often require root access, it is convenient to
use this XR\_RUNTIME\_JSONS environment variable to locate a specific JSON file.

Therefore, the user might set XR\_RUNTIME\_JSON to `<build_dir>/src/impl/openxr_sample_impl.json`

For example, if your build directory is `build` in the top of the tree, you can execute:
```
LD_LIBRARY_PATH=build/src/impl XR_RUNTIME_JSON=build/src/impl/openxr_sample_impl.json build/src/tests/hello_xr/hello_xr
```

### Configuring the OpenXR Loader - Windows

The intended way for the loader to find the runtime in a production environment is via the Windows Registry.
In a development environment it is generally easier to set the XR\_RUNTIME\_JSONS environment variable to
`<build_dir>/src/impl/openxr_sample_impl.json`.
This can be done in the Properties panel for the hello_xr test app in Visual Studio.

## Running the Hello_XR Test

The binary for the hello_xr application is written to the <build_dir>/src/tests/hello_xr directory.
Set your working directory to this directory and execute the hello_xr binary.

# Hello_XR with a dynamic loader 

When building a DLL version of the loader, the Visual Studio projects generated by CMake will copy the loader
DLLs to the test application's (hello_xr) binary directory.
This makes it unnecessary to copy these files to someplace like Windows/System32.

