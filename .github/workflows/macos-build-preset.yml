# Copyright 2021-2024, Collabora, Ltd.
# SPDX-License-Identifier: CC0-1.0

name: macOS builds
on:
  workflow_call:
    # inputs:
    #   organizeAndRelease:
    #     description: "Should we organize and release our artifacts?"
    #     type: boolean
    #     default: false
  workflow_dispatch:

jobs:
  build-macos:
    runs-on: macos-latest

    steps:
      # Step 1: Checkout the repository
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Step 2: Set up Homebrew and install dependencies
      - name: Install Dependencies
        run: |
          brew update
          brew install cmake ninja
          # Add any additional dependencies here
          
      # Step 3: Configure the build with CMake
      - name: Configure Build
        run: |
          mkdir build
          cd build
          cmake -G Ninja \
                -DCMAKE_BUILD_TYPE=RelWithDebInfo \
                -DCMAKE_INSTALL_PREFIX=../install \
                ..

      # Step 4: Build the project
      - name: Build OpenXR Loader
        run: |
          cd build
          cmake --build . --target install

      # Step 5: Package the build artifacts
      - name: Package Artifacts
        run: |
          cd install
          tar -czvf OpenXR-Loader-macos-package.tar.gz *

      # Step 6: Upload the build artifacts
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: OpenXR-Loader-macos-package
          path: install/OpenXR-Loader-macos-package.tar.gz
